## Приложение чат

В этом репозитории реализована вторая часть тестового задания. Первая часть [тут](https://github.com/gabyshev/chat_monolith).

### Требования

Функционал:
- Пользователь может зарегистрироваться в системе.
- Пользователь может авторизоваться в системе.
- Авторизовавшийся пользователь может пользоваться чатом с другими пользователями системы. В  чате можно отправлять и принимать сообщения от собеседников.

Способ реализации:
- приложение, состоящее из 2-х микросервисов
  - Микросервис 1 - приложение на Ruby on Rails, которое занимается бизнес логикой пользователя - профайл, логин, и т.д.
  - Микросервис 2 - приложение на Node.js, которое занимается только чатом и поддержкой асинхронных веб сокетов.

###  Реализация

##### Микросервис на Ruby on Rails (**API**)

Этот микросервис отвечает за регистрацию, логин пользователей и хранение/передачу данных о чатах между пользователями и их сообщений. Коммуникация между контейнерами происходит по REST API. Для аутентификации и авторизации пользователей приложение при успешном логине отдает токен сгенерированный с помощью [JWT](http://jwt.io/). Контроллеры `Conversations` и `Messages` перед экшном вызывают `verify_jwt_token` для авторизации пользователя.

##### Микросервис на Node.js (**WEB**)

Веб сервер Express который следит за урлами:
- `/message`
- `/api`

В остальных случаях отдает статику с фронтенд приложением на AngularJS.

`/message` - нужен для паблишинга сообщений в вебсокет канал. Вебсокеты реализованы с помощью Faye.

`/api` - по этому урлу приходят запросы с фронтенда(авторизация, чат и сообщения), которые проксируются через сервер на Docker контейнер с Ruby on Rails.

Также в [этом](https://github.com/gabyshev/microservices_chat/commit/64c420ba85f0b8037c0ee086cb0ff87ce227e933) коммите, я вставил разъясняющие комментарии на все важные, на мой взгляд, моменты в приложении.

### Запуск

На хостовой машние должен быть установлен Docker Compose.

```
cd ../path/to/app
docker-compose build
docker-compose up
```
Если запуск происходит с OS X, приложение можно будет открыть по IP-адресу который хранится в ENV `$DOCKER_HOST` с портом 80.
Для Linux, приложение можно будет посмотреть по `localhost`

### Возможные улучшения

1. Обработка ошибок. В данной реализации опущена обработка большинства ошибок для быстроты реализации. В реальном приложени нужно обратывать все виды ошибок.
1. Docker Compose не предназначен для запуска в production окружении. В зависимости от величины приложения есть широкий набор Orchestration Tool программ.
2. Микросервисная архитектура предполагает автоматизированный мониторинг контейнеров.
3. С ростом приложения логика на фронте тоже будет расти. Поэтому приложение на Angular тоже нужно структурировать
4. Серварная безопасность Node js контейнера. Сейчас кто угодно можно послать POST запрос в `/messages` и  тем самым вклиниться в разговор. Нужен дополнительный слой логики для авторизации пользователей на сервере.
